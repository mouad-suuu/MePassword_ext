flowchart TD
    subgraph Client["Client Environment (Browser Extension)"]
        UI[/"User Interface"/]
        KG["Key Generation\n(RSA 4096-bit & AES-256)"]
        LE["Local Encryption Module"]
        LD["Local Decryption Module"]
        BIO["Biometric Auth Module"]
        SKS["Secure Key Storage\n(Protected Memory)"]

        UI --> |"1. Init Request"| KG
        KG --> |"2. Store Keys"| SKS
        UI --> |"3. Auth Request"| BIO
        BIO --> |"4. Verify"| SKS
    end

    subgraph WebApp["Web Application (Next.js)"]
        API["API Layer\n(Rate Limited)"]
        AUTH["Auth Service\n(Zero Knowledge)"]
        STORE["Encrypted Storage"]
        AUDIT["Audit Logger"]

        API --> |"Verify"| AUTH
        API --> |"Log Access"| AUDIT
        API <--> |"Read/Write"| STORE
    end

    subgraph Org["Organization Management"]
        RBAC["Role-Based Access Control"]
        TEAM["Team Management"]
        VAULT["Password Vaults"]

        RBAC --> |"Control"| TEAM
        TEAM --> |"Access"| VAULT
    end

    %% Data Flow Lines
    UI <--> |"5. HTTPS/TLS 1.3\nPerfect Forward Secrecy"| API

    %% Security Measures
    classDef securityCheck fill:#f96,stroke:#333,stroke-width:2px
    class KG,AUTH,RBAC securityCheck

    %% Critical Data Points
    classDef criticalData fill:#f66,stroke:#333,stroke-width:4px
    class SKS,STORE criticalData

    %% Security Notes
    note1["🔒 All data encrypted\nbefore transmission"]
    note2["⚠️ Potential Memory\nDump Vulnerability"]
    note3["🔑 Key rotation every\n30 days"]
    note4["📝 Audit logs encrypted\nbut searchable"]

    note1 --> LE
    note2 --> SKS
    note3 --> KG
    note4 --> AUDIT

    %% Data Flow Details
    subgraph DataFlow["Data Flow Security"]
        direction TB
        E1["1. Data Encryption (AES-GCM)"]
        E2["2. RSA Signature"]
        E3["3. TLS Encryption"]
        E4["4. Zero-Knowledge Proof"]

        E1 --> E2 --> E3 --> E4
    end

    subgraph KeyStorage["Key Management"]
        direction TB
        K1["1. Master Key (RSA-4096)"]
        K2["2. Derived Keys (PBKDF2)"]
        K3["3. Session Keys"]
        K4["4. Biometric Keys"]

        K1 --> K2 --> K3 --> K4
    end

    %% Vulnerability Points
    style SKS fill:#f99,stroke:#f66,stroke-width:4px
    style API fill:#ff9,stroke:#cc9,stroke-width:2px
    style BIO fill:#ff9,stroke:#cc9,stroke-width:2px

    %% Security Checkpoints
    CP1{{"Integrity Check"}}
    CP2{{"Rate Limiter"}}
    CP3{{"Auth Validator"}}

    UI --> CP1
    API --> CP2
    AUTH --> CP3

    classDef checkpoint fill:#9f9,stroke:#333,stroke-width:2px
    class CP1,CP2,CP3 checkpoint