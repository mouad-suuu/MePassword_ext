(()=>{"use strict";const e={PASSWORD_INPUTS:['input[type="password"]','input[name*="pass" i]','input[id*="pass" i]','input[class*="pass" i]','input[aria-label*="password" i]'],USERNAME_INPUTS:['input[type="text"]','input[type="email"]','input[name*="user" i]','input[name*="email" i]','input[id*="user" i]','input[id*="email" i]','input[class*="user" i]','input[class*="email" i]','input[aria-label*="username" i]','input[aria-label*="email" i]'],SUBMIT_BUTTONS:['button[type="submit"]','input[type="submit"]','button[name*="login" i]','button[id*="login" i]','button[class*="login" i]','a[href*="login" i]']},t=new class{constructor(){this.observedForms=new Set,this.lastDetectedCredentials=null,this.typingTimer=null,this.TYPING_TIMEOUT=5e3,this.isAutoFilling=!1,this.mutationObserver=new MutationObserver(this.handleDOMChanges.bind(this)),this.setupMutationObserver(),this.createFloatingButton()}setupMutationObserver(){this.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})}findUsernameField(t,i){var n,s,o,r,a,l,d,u;const c=Array.from(t.getElementsByTagName("input")),m=c.indexOf(i),h=c.slice(0,m);for(const e of h.reverse())if("text"===e.type||"email"===e.type||(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes("user"))||(null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes("email"))||(null===(o=e.id)||void 0===o?void 0:o.toLowerCase().includes("user"))||(null===(r=e.id)||void 0===r?void 0:r.toLowerCase().includes("email")))return e;const p=c.slice(m+1);for(const e of p)if("text"===e.type||"email"===e.type||(null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes("user"))||(null===(l=e.name)||void 0===l?void 0:l.toLowerCase().includes("email"))||(null===(d=e.id)||void 0===d?void 0:d.toLowerCase().includes("user"))||(null===(u=e.id)||void 0===u?void 0:u.toLowerCase().includes("email")))return e;return t.querySelector(e.USERNAME_INPUTS.join(","))||void 0}extractCredentials(e){var t,i;return{website:window.location.origin,user:(null===(t=e.usernameField)||void 0===t?void 0:t.value)||"",password:(null===(i=e.passwordField)||void 0===i?void 0:i.value)||"",formData:{url:window.location.href,title:document.title,timestamp:(new Date).toISOString()}}}async notifyCredentialDetection(e){if(!this.isDuplicateCredential(e)){this.lastDetectedCredentials=Object.assign(Object.assign({},e),{timestamp:Date.now()});try{if(!chrome.runtime||!chrome.runtime.id)throw new Error("Extension needs to be reloaded to function properly");await chrome.runtime.sendMessage({type:"PASSWORD_DETECTED",data:e})}catch(e){throw"Extension context invalidated."===e?new Error("Please refresh the page to continue using MePassword"):new Error("Unable to save credentials. Please try again later")}}}async handleDOMChanges(e){for(const t of e)if(t.addedNodes.length>0){const e=Array.from(t.addedNodes);for(const t of e)t instanceof HTMLElement&&await this.processNewElement(t)}}async processNewElement(t){const i="FORM"===t.tagName?[t]:Array.from(t.getElementsByTagName("form"));for(const e of i)await this.attachFormListeners(e);const n=Array.from(t.querySelectorAll(e.PASSWORD_INPUTS.join(",")));for(const e of n)e.form||this.createVirtualForm(e)}createVirtualForm(e){var t;const i=document.createElement("form");i.setAttribute("data-virtual-form","true"),null===(t=e.parentElement)||void 0===t||t.insertBefore(i,e),i.appendChild(e.cloneNode(!0)),e.remove(),this.attachFormListeners(i)}findFormElements(t){const i=t.querySelector(e.PASSWORD_INPUTS.join(","));if(!i)throw new Error("No password field found in form");const n=this.findUsernameField(t,i),s=t.querySelector(e.SUBMIT_BUTTONS.join(","));return{form:t,usernameField:n,passwordField:i,submitButton:s}}getDistanceToPassword(e,t){const i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return Math.abs(i.top-n.top)}attachFormListeners(e){if(!this.observedForms.has(e))try{const t=this.findFormElements(e);this.observedForms.add(e);const i=()=>{this.typingTimer&&clearTimeout(this.typingTimer),t.passwordField.value?this.floatingButton.style.display="block":this.floatingButton.style.display="none",this.typingTimer=setTimeout((()=>{if(t.passwordField.value){const e=this.extractCredentials(t);e&&this.notifyCredentialDetection(e)}}),this.TYPING_TIMEOUT)};t.passwordField.addEventListener("input",i),t.usernameField&&t.usernameField.addEventListener("input",i),e.addEventListener("submit",(e=>{this.typingTimer&&clearTimeout(this.typingTimer),this.handleFormSubmission(e,t)}))}catch(e){}}async handleFormSubmission(e,t){const i=this.extractCredentials(t);if(null==i?void 0:i.password)try{await this.notifyCredentialDetection(i)}catch(e){}}async handleInputChange(e){if(this.isAutoFilling)return;const t=this.extractCredentials(e);if(null==t?void 0:t.password)try{await this.notifyCredentialDetection(t)}catch(e){}}createFloatingButton(){this.floatingButton=document.createElement("button"),this.floatingButton.innerHTML="Save Password",this.floatingButton.style.cssText="\n      position: fixed;\n      right: 20px;\n      bottom: 20px;\n      z-index: 10000;\n      padding: 10px 20px;\n      font-size: 14px;\n      border-radius: 8px;\n      border: none;\n      background: #007bff;\n      color: white;\n      cursor: pointer;\n      box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n      transition: all 0.3s ease;\n      display: none;\n    ",this.floatingButton.addEventListener("mouseover",(()=>{this.floatingButton.style.transform="scale(1.05)",this.floatingButton.style.background="#0056b3"})),this.floatingButton.addEventListener("mouseout",(()=>{this.floatingButton.style.transform="scale(1)",this.floatingButton.style.background="#007bff"})),this.floatingButton.addEventListener("click",(()=>{this.typingTimer&&clearTimeout(this.typingTimer),this.detectAndSaveCredentials()})),document.body.appendChild(this.floatingButton)}detectAndSaveCredentials(){document.querySelectorAll("form").forEach((e=>{try{const t=this.findFormElements(e),i=this.extractCredentials(t);(null==i?void 0:i.website)&&(null==i?void 0:i.password)&&(chrome.runtime.sendMessage({type:"PASSWORD_DETECTED",data:i}),this.floatingButton.style.display="none")}catch(e){}}))}initialize(){document.querySelectorAll("form").forEach((e=>{this.attachFormListeners(e)})),document.querySelectorAll(e.PASSWORD_INPUTS.join(",")).forEach((e=>{e.closest("form")||this.createVirtualForm(e)}))}setAutoFilling(e){this.isAutoFilling=e}getAutoFilling(){return this.isAutoFilling}isDuplicateCredential(e){return!!this.lastDetectedCredentials&&(Date.now()-this.lastDetectedCredentials.timestamp<this.TYPING_TIMEOUT&&this.lastDetectedCredentials.website===e.website&&this.lastDetectedCredentials.user===e.user&&this.lastDetectedCredentials.password===e.password)}};t.initialize();let i=location.href;new MutationObserver((()=>{location.href!==i&&(i=location.href,t.initialize())})).observe(document,{subtree:!0,childList:!0}),chrome.runtime.onMessage.addListener(((i,n,s)=>{if("AUTO_FILL_CREDENTIALS"===i.type){const{user:n,password:o}=i.data;t.setAutoFilling(!0);const r=document.querySelectorAll(e.PASSWORD_INPUTS.join(",")),a=document.querySelectorAll(e.USERNAME_INPUTS.join(","));r.length>0&&(r[0].value=o,r[0].dispatchEvent(new Event("input",{bubbles:!0}))),a.length>0&&n&&(a[0].value=n,a[0].dispatchEvent(new Event("input",{bubbles:!0}))),setTimeout((()=>{t.setAutoFilling(!1)}),1e3),s({success:!0})}}))})();
//# sourceMappingURL=content.js.map